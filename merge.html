<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF SELEK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS (same as index) -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<nav class="navbar navbar-expand-lg fixed-top shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">PDFSelek</a>

    <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="merge.html">Merge</a></li>
        <li class="nav-item"><a class="nav-link" href="split.html">Split</a></li>
        <li class="nav-item"><a class="nav-link" href="split-and-merge.html">Split & Merge</a></li>
      </ul>
    </div>
  </div>
</nav>

<div style="height:80px"></div>

<!-- ================= MERGE PAGE ================= -->
<section class="py-5">
  <div class="container">

    <!-- Title -->
    <div class="d-flex align-items-center justify-content-center mb-3">
    <h1 class="fw-bold me-3">Merge PDF File</h1>
    
    <!-- Attractive Question Mark Icon -->
    <button
        type="button"
        class="help-icon"
        data-bs-toggle="modal"
        data-bs-target="#helpModal"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Click for help"
    >
        ?
    </button>
    </div>

    <!-- Upload Area -->
    <div class="upload-box text-center mb-5">
      <input
        type="file"
        id="pdfUpload"
        accept=".pdf"
        multiple
        hidden
      >

      <div class="upload-inner">
        <div class="upload-icon mb-3">ðŸ“¤</div>
        <h5 class="fw-semibold mb-2">Drop PDF files here</h5>
        <p class="text-muted mb-4">or click the button below</p>

        <label for="pdfUpload" class="btn btn-primary btn-lg">
          Select PDF Files
        </label>
      </div>
    </div>

    <!-- Preview Container -->
    <div
      id="pdfPreviewContainer"
      class="preview-grid mb-5"
    ></div>

<!-- Merge Button -->
<div class="text-center d-none" id="mergeButtonWrapper">
  <button
    id="mergeButton"
    class="btn btn-primary btn-lg px-5 shadow"
  >
    Merge PDF Files
  </button>
</div>
  </div>
</section>

<!-- ================= FOOTER ================= -->
<footer class="footer">
  <div class="container">
    <hr>
    <p class="text-center text-muted small mb-0">
      Â© 2026 PDFSelek. All rights reserved.
    </p>
  </div>
</footer>
<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title">How it works</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="mb-0">
            <li>Upload multiple PDF files</li>
            <li>Reorder using left & right buttons</li>
            <li>Click merge and download</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- ================= JS (YOUR SCRIPT) ================= -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>


<script>
document.addEventListener("DOMContentLoaded", () => {

  // ================= ELEMENTS =================
  const uploadBox = document.querySelector(".upload-box");
  const pdfUpload = document.getElementById("pdfUpload");
  const pdfPreviewContainer = document.getElementById("pdfPreviewContainer");
  const mergeButton = document.getElementById("mergeButton");
  const mergeButtonWrapper = document.getElementById("mergeButtonWrapper");


  // ================= PDF.JS WORKER =================
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.worker.min.js";

  let pdfFiles = [];

  // ================= FILE HANDLER =================
  async function handleFiles(files) {
    const fileArray = Array.from(files);
    pdfFiles = [...pdfFiles, ...fileArray];

    for (const file of fileArray) {
      const pdfData = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;

      const page = await pdf.getPage(1);
      const viewport = page.getViewport({ scale: 0.3 });

      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({ canvasContext: ctx, viewport }).promise;

      const previewDiv = document.createElement("div");
      previewDiv.className = "pdf-preview";
      previewDiv.dataset.fileIndex = pdfFiles.indexOf(file);

      const controls = document.createElement("div");
      controls.className = "controls";

      const leftBtn = document.createElement("button");
      leftBtn.textContent = "â—€";
      leftBtn.onclick = () => movePdf(previewDiv, "left");

      const rightBtn = document.createElement("button");
      rightBtn.textContent = "â–¶";
      rightBtn.onclick = () => movePdf(previewDiv, "right");

      controls.append(leftBtn, rightBtn);
      previewDiv.append(canvas, controls);
      pdfPreviewContainer.appendChild(previewDiv);
    }
  }

  // ================= FILE INPUT =================
  pdfUpload.addEventListener("change", (e) => {
    handleFiles(e.target.files);
    mergeButtonWrapper.classList.remove("d-none");
  });

  // ================= DRAG & DROP =================
  ["dragenter", "dragover", "dragleave", "drop"].forEach(event => {
    uploadBox.addEventListener(event, e => e.preventDefault());
    document.body.addEventListener(event, e => e.preventDefault());
  });

  uploadBox.addEventListener("dragover", () => {
    uploadBox.classList.add("dragover");
  });

  uploadBox.addEventListener("dragleave", () => {
    uploadBox.classList.remove("dragover");
  });

  uploadBox.addEventListener("drop", (e) => {
    uploadBox.classList.remove("dragover");

    const pdfs = Array.from(e.dataTransfer.files).filter(
      file => file.type === "application/pdf"
    );

    if (!pdfs.length) return;

    handleFiles(pdfs);
  });

  // ================= REORDER =================
  function movePdf(element, direction) {
    const items = Array.from(pdfPreviewContainer.children);
    const index = items.indexOf(element);
    const target = direction === "left" ? index - 1 : index + 1;

    if (target < 0 || target >= items.length) return;

    pdfPreviewContainer.insertBefore(
      direction === "left" ? element : items[target],
      direction === "left" ? items[target] : element
    );

    pdfFiles = Array.from(pdfPreviewContainer.children).map(
      el => pdfFiles[el.dataset.fileIndex]
    );

    Array.from(pdfPreviewContainer.children).forEach((el, i) => {
      el.dataset.fileIndex = i;
    });
  }

  // ================= MERGE =================
  mergeButton.addEventListener("click", async () => {
    const mergedPdf = await PDFLib.PDFDocument.create();

    for (const file of pdfFiles) {
      const bytes = await file.arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(bytes);
      const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
      pages.forEach(p => mergedPdf.addPage(p));
    }

    const blob = new Blob([await mergedPdf.save()], { type: "application/pdf" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "merged.pdf";
    a.click();
  });

});
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
