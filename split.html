<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Selek</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<nav class="navbar navbar-expand-lg fixed-top shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">PDFSelek</a>

    <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="merge.html">Merge</a></li>
        <li class="nav-item"><a class="nav-link" href="split.html">Split</a></li>
        <li class="nav-item"><a class="nav-link" href="split-and-merge.html">Split & Merge</a></li>
      </ul>
    </div>
  </div>
</nav>

<div style="height:80px"></div>

<!-- ================= SPLIT PDF PAGE ================= -->
<section class="py-5">
  <div class="container">

    <!-- Title -->
    <div class="d-flex align-items-center justify-content-center mb-3">
    <h1 class="fw-bold me-3">Split PDF File</h1>
    
    <!-- Attractive Question Mark Icon -->
    <button
        type="button"
        class="help-icon"
        data-bs-toggle="modal"
        data-bs-target="#helpModal"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Click for help"
    >
        ?
    </button>
    </div>

    <!-- Upload Box -->
    <div class="upload-box text-center mb-5">
      <input
        type="file"
        id="pdfInput"
        accept=".pdf"
        hidden
      />

      <div class="upload-inner">
        <div class="upload-icon mb-3">ðŸ“„</div>
        <h5 class="fw-semibold mb-2">Drop PDF file here</h5>
        <p class="text-muted mb-4">or click the button below</p>

        <label for="pdfInput" class="btn btn-primary btn-lg">
          Select PDF File
        </label>
      </div>
    </div>

        <!-- Split Controls -->
    <div class="split-card p-4 mb-4">
      <h5 class="fw-semibold mb-3">Split Options</h5>

      <div class="mb-3">
        <label class="form-label">Page numbers</label>
        <input
          type="text"
          id="pageNumbers"
          class="form-control"
          placeholder="e.g. 1,3,5-7"
        />
      </div>

      <div class="text-center">
        <button
          id="splitButton"
          class="btn btn-primary btn-lg px-5"
        >
          Split PDF
        </button>
      </div>
    </div>

    <!-- Status -->
    <p id="status" class="text-center text-muted"></p>

    <!-- Loading Message -->
    <div
      id="loadingMessage"
      class="text-center text-muted mb-4"
      style="display:none;"
    >
      Loading PDF pages...
    </div>

    <!-- PDF Preview -->
    <div id="pdfViewer" class="mb-5"></div>
  </div>
</section>

<!-- ================= FOOTER ================= -->
<footer class="footer">
  <div class="container">
    <hr>
    <p class="text-center text-muted small mb-0">
      Â© 2026 PDFTools. All rights reserved.
    </p>
  </div>
</footer>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">
      
      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold">How Split PDF Works</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body pt-0">
        <ol class="mb-0 ps-3">
          <li class="mb-2">
            Upload a single PDF file you want to split
          </li>
          <li class="mb-2">
            Select pages by clicking them or entering page ranges
          </li>
          <li class="mb-2">
            Split the PDF into separate files or sections
          </li>
          <li>
            Download your newly split PDF files instantly
          </li>
        </ol>
      </div>

      <div class="modal-footer border-0">
        <button
          class="btn btn-primary px-4 rounded-pill"
          data-bs-dismiss="modal"
        >
          Got it
        </button>
      </div>

    </div>
  </div>
</div>


<!-- ================= YOUR EXISTING JS ================= -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

  <script>
    const pdfInput = document.getElementById('pdfInput');
    const pdfViewer = document.getElementById('pdfViewer');
    const loadingMessage = document.getElementById('loadingMessage');

    pdfInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];

      if (file) {
        loadingMessage.style.display = 'block'; // Show loading message

        const fileReader = new FileReader();

        fileReader.onload = async function () {
          const typedArray = new Uint8Array(this.result);
          const pdf = await pdfjsLib.getDocument(typedArray).promise;

          // Clear previous previews
          pdfViewer.innerHTML = '';

          // Render the first page for preview
          renderPdfPage(pdf, 1);
        };

        fileReader.readAsArrayBuffer(file);
      }
    });

    async function renderPdfPage(pdf, pageNumber) {
    try {
        const page = await pdf.getPage(pageNumber);

        // Smaller scale for thumbnails
        const scale = 0.6;
        const viewport = page.getViewport({ scale });

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({
        canvasContext: context,
        viewport
        }).promise;

        const img = document.createElement('img');
        img.src = canvas.toDataURL('image/png');
        img.alt = `Page ${pageNumber}`;
        img.loading = 'lazy';
        img.onclick = () => selectPage(pageNumber);

        const pageNumberDiv = document.createElement('div');
        pageNumberDiv.className = 'page-number';
        pageNumberDiv.textContent = `Page ${pageNumber}`;

        const pageContainer = document.createElement('div');
        pageContainer.className = 'page-container';
        pageContainer.appendChild(img);
        pageContainer.appendChild(pageNumberDiv);

        pdfViewer.appendChild(pageContainer);

        if (pageNumber < pdf.numPages) {
        renderPdfPage(pdf, pageNumber + 1);
        } else {
        loadingMessage.style.display = 'none';
        }

    } catch (error) {
        console.error('Error rendering page:', error);
        loadingMessage.textContent = 'Error loading PDF. Please try again.';
    }
    }


    function selectPage(pageNumber) {
    const pageNumbersInput = document.getElementById('pageNumbers');
    const pageContainers = document.querySelectorAll('.page-container');

    let currentPages = pageNumbersInput.value
        .split(',')
        .map(num => parseInt(num.trim(), 10))
        .filter(num => !isNaN(num));

    if (currentPages.includes(pageNumber)) {
        currentPages = currentPages.filter(p => p !== pageNumber);
    } else {
        currentPages.push(pageNumber);
    }

    pageNumbersInput.value = currentPages.join(',');

    // Visual highlight
    pageContainers.forEach(container => {
        const label = container.querySelector('.page-number');
        if (label.textContent === `Page ${pageNumber}`) {
        container.classList.toggle('selected');
        }
    });
    }


    function parsePageRanges(input) {
      const pages = [];
      const ranges = input.split(',');

      ranges.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          if (start && end && start <= end) {
            for (let i = start; i <= end; i++) {
              pages.push(i);
            }
          }
        } else {
          const num = parseInt(range.trim(), 10);
          if (!isNaN(num)) {
            pages.push(num);
          }
        }
      });

      return pages;
    }

    document.getElementById('splitButton').addEventListener('click', async () => {
      const pageNumbersInput = document.getElementById('pageNumbers');
      const statusElement = document.getElementById('status');

      if (!pdfInput.files.length) {
        statusElement.textContent = 'Please upload a PDF file.';
        return;
      }

      const pageNumbers = parsePageRanges(pageNumbersInput.value);

      if (!pageNumbers.length) {
        statusElement.textContent = 'Please enter valid page numbers.';
        return;
      }

      const file = pdfInput.files[0];
      const arrayBuffer = await file.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

      const newPdf = await PDFLib.PDFDocument.create();

      for (const pageNumber of pageNumbers) {
        if (pageNumber > 0 && pageNumber <= pdfDoc.getPageCount()) {
          const [copiedPage] = await newPdf.copyPages(pdfDoc, [pageNumber - 1]);
          newPdf.addPage(copiedPage);
        } else {
          statusElement.textContent = `Page number ${pageNumber} is out of range.`;
          return;
        }
      }

      const newPdfBytes = await newPdf.save();

      const blob = new Blob([newPdfBytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'split.pdf';
      link.click();

      statusElement.textContent = 'PDF successfully split and downloaded!';
    });

// ================= DRAG & DROP =================
const uploadBox = document.querySelector('.upload-box');

["dragenter", "dragover"].forEach(event => {
  uploadBox.addEventListener(event, e => {
    e.preventDefault();
    uploadBox.classList.add("dragover");
  });
});

["dragleave", "drop"].forEach(event => {
  uploadBox.addEventListener(event, e => {
    e.preventDefault();
    uploadBox.classList.remove("dragover");
  });
});

uploadBox.addEventListener("drop", (e) => {
  const files = Array.from(e.dataTransfer.files).filter(
    file => file.type === "application/pdf"
  );

  if (!files.length) return;

  // Put dropped files into the file input
  const dataTransfer = new DataTransfer();
  files.forEach(file => dataTransfer.items.add(file));

  pdfInput.files = dataTransfer.files;

  // Trigger existing upload logic
  pdfInput.dispatchEvent(new Event("change"));
});

  </script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
</script>
</body>
</html>
